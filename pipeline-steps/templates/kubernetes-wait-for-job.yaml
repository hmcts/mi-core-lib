steps:
  - bash: |
      timeout=180
      until [[ $SECONDS -gt $timeout ]] \
        || [[ $(kubectl get jobs mi-integration-service-job --namespace mi -o jsonpath='{.status.conditions[?(@.type=="Failed")].status}') == 'True' ]] \
        || [[ $(kubectl get jobs mi-integration-service-job --namespace mi -o jsonpath='{.status.conditions[?(@.type=="Completed")].status}') == 'True' ]];
      do
        echo "Waiting for Job Completion"
        sleep 5
      done
      if [[ $SECONDS -gt $timeout ]]; then
      	echo "Timed out waiting for Job Completion"
      fi
  displayName: 'Wait for job completion'