parameters:
  azureSubscriptionEndpoint: $(azure.subscription.endpoint)
  azureVault: ''
  vaultSecretName: ''
  vaultSecretNameToSet: ''
  vaultValueToReplace: ''
  vaultValueReplace: ''

steps:
  - task: AzureCLI@2
    displayName: "Replace value in vault"
    inputs:
      azureSubscription: 'DTS-SHAREDSERVICES-${{ upper(parameters.env) }}'
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
          currentValue=$(az keyvault secret show --vault-name ${{ parameters.azureVault }} --name ${{ parameters.vaultSecretName }} --query 'value' -o tsv)
          newValue=${currentValue//"${{ parameters.vaultValueToReplace }}"/"${{ parameters.vaultValueReplace }}"}
          trimmedNewValue=$(echo $newValue | xargs)

          az keyvault secret set --name ${{ parameters.vaultSecretNameToSet }} --vault-name $vaultName --value "$trimmedNewValue" --output none
