parameters:
  azureSubscriptionEndpoint: $(azure.subscription.endpoint)
  azureVault: ''
  secretName: ''
  secretValue: ''

steps:
  - task: AzureCLI@2
    displayName: "Set vault secrets ${{ parameters.secretName }}"
    inputs:
      azureSubscription: ${{ parameters.azureSubscriptionEndpoint }}
      scriptType: 'bash'
      scriptLocation: "inlineScript"
      inlineScript: |
          currentValue=$(az keyvault secret show --vault-name ${{ parameters.azureVault }} --name ${{ parameters.secretName }} --query 'value' -o tsv)
          az keyvault secret download -vault-name ${{ parameters.azureVault }} --name ${{ parameters.secretName }} --file secret.txt
  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: secret.txt
      ArtifactName: secret.txt
